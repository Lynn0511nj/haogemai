# 多视角诊断功能说明

## 功能概述

多视角诊断是一个创新的分享激励机制，通过**分享解锁不同诊断视角**来提升用户留存与传播率，同时**严格控制模型调用成本**。

## 核心策略

### 1. 一次诊断，多个视角

- **首次诊断时**：一次性生成完整的多视角数据池（6个视角）
- **默认展示**：只展示 1 个视角（内容视角）
- **分享解锁**：通过分享解锁其他 2-3 个视角
- **关键原则**：所有视角来自首次诊断缓存，**不重跑模型**

### 2. 成本控制

✅ **允许**：
- 首次诊断时调用模型生成完整数据池
- 从缓存中读取不同视角

❌ **禁止**：
- 因分享而重新调用模型
- 重复生成相同的诊断数据

### 3. 每日限制

- 每个用户每天最多 **1 次分享奖励**
- 分享奖励在次日自动重置
- 所有视角解锁后，隐藏分享入口

## 六大诊断视角

### 1. 内容视角 (content_view)
- **默认解锁**
- 从内容质量、情绪唤起能力角度分析
- 图标：📄 文档

### 2. 用户心理视角 (user_psychology_view)
- 从用户看到主页时的心理感受分析
- 图标：😊 笑脸

### 3. 增长瓶颈视角 (growth_bottleneck_view)
- 从增长卡点、流量瓶颈角度分析
- 图标：📈 增长曲线

### 4. 账号定位视角 (account_positioning_view)
- 从账号定位、标签收敛角度分析
- 图标：📍 定位

### 5. 优化行动视角 (optimization_actions_view)
- 从可执行的优化行动角度分析
- 图标：✅ 清单

### 6. 案例参考视角 (case_reference_view)
- 从同类型账号案例角度分析
- 图标：📚 书籍

## 用户流程

### 流程 A：免费用户

```
1. 完成首次诊断 → 生成完整数据池（6个视角）
2. 查看初步诊断结果 → 只展示基础信息
3. 点击"查看多视角诊断" → 看到 1 个解锁视角 + 5 个锁定视角
4. 点击"分享解锁更多视角" → 解锁 2-3 个新视角
5. 次日可再次分享 → 继续解锁剩余视角
```

### 流程 B：付费用户

```
1. 完成首次诊断 → 生成完整数据池
2. 解锁完整报告（¥29.9）→ 查看 7 天行动清单
3. 点击"查看多视角诊断" → 看到 1 个解锁视角 + 5 个锁定视角
4. 通过分享继续解锁其他视角
```

## 技术实现

### 数据结构

```typescript
// 多视角诊断数据池（首次诊断时生成）
interface MultiViewDiagnosis {
  base_summary: string;        // 快速结论
  core_score: number;           // 综合评分 1-10
  diagnosis_modules: {
    content_view: DiagnosisModule;
    account_positioning_view: DiagnosisModule;
    user_psychology_view: DiagnosisModule;
    growth_bottleneck_view: DiagnosisModule;
    optimization_actions_view: DiagnosisModule;
    case_reference_view: DiagnosisModule;
  };
}

// 用户解锁状态（存储在 localStorage）
interface UnlockStatus {
  share_reward_used_today: boolean;  // 今日是否已使用分享奖励
  unlocked_modules: string[];        // 已解锁的模块ID列表
  last_share_date: string;           // 最后分享日期
}
```

### 核心函数

#### `unlockManager.ts`

```typescript
// 检查是否可以使用分享奖励
canUseShareReward(): boolean

// 执行分享解锁（返回新解锁的视角ID列表）
unlockByShare(): string[]

// 获取未解锁的视角数量
getRemainingModulesCount(): number

// 检查是否所有视角已解锁
isAllModulesUnlocked(): boolean
```

### 组件结构

```
App.tsx
├── renderResult()           // 初步诊断结果页
│   └── "查看多视角诊断" 按钮
├── renderFullReport()       // 完整报告页
│   └── "查看多视角诊断" 按钮
├── MultiViewDiagnosis       // 多视角诊断页面
│   ├── 综合评分卡片
│   ├── 6个视角模块（部分锁定）
│   └── "分享解锁更多视角" 按钮
└── ShareModal               // 分享模态框
    ├── 检查今日是否可分享
    ├── 显示可解锁视角数量
    └── 执行解锁逻辑
```

## UI 文案

### 入口提示

**初步诊断结果页**：
```
想从更多角度看这份诊断？

同一份诊断，我们还准备了 6 个不同视角：
内容、定位、用户心理、增长瓶颈、优化行动、案例参考

[查看多视角诊断]
```

**完整报告页**：
```
底部按钮：
[生成报告长图] [查看多视角诊断]
```

### 多视角页面

**页面标题**：
```
多视角诊断
同一份诊断，从不同角度看
```

**提示信息**：
```
ℹ️ 以下所有视角来自同一次诊断结果，不会重复检测，
但会带你看到之前没展示的分析角度。
```

**锁定视角卡片**：
```
🔒 分享后解锁
```

**底部分享提示**：
```
还有 X 个视角未解锁
分享后立即解锁 2-3 个新视角

[分享解锁更多视角]
```

### 分享模态框

**标题**：
```
分享即可解锁更多视角
```

**描述**：
```
同一份诊断，从不同角度看，会有新的发现。
分享后解锁 2-3 个新视角
```

**说明**：
```
ℹ️ 关于视角解锁

本次解锁基于同一份诊断结果，不会重复检测，
但会带你看到之前没展示的分析角度。
```

**分享成功反馈**：
```
🎉 已解锁新视角

我们帮你从「用户心理视角、增长瓶颈视角」角度，
重新看了这份诊断
```

**今日已分享**：
```
今天已经使用过分享奖励啦～
```

**所有视角已解锁**：
```
🎉 所有视角已解锁
```

## 开发测试

### 重置解锁状态

在浏览器控制台执行：

```javascript
// 导入重置函数
import { resetUnlockStatus } from './services/unlockManager';

// 重置解锁状态
resetUnlockStatus();

// 或直接清除 localStorage
localStorage.removeItem('unlock_status');
```

### 测试流程

1. **首次诊断**：
   - 上传图片，完成诊断
   - 检查 `result.multiViewDiagnosis` 是否包含 6 个视角

2. **查看多视角**：
   - 点击"查看多视角诊断"
   - 确认只有 `content_view` 解锁
   - 其他 5 个视角显示为锁定状态

3. **分享解锁**：
   - 点击"分享解锁更多视角"
   - 确认解锁 2-3 个新视角
   - 检查 localStorage 中的 `unlock_status`

4. **每日限制**：
   - 再次点击分享按钮
   - 确认提示"今天已经使用过分享奖励啦～"

5. **次日重置**：
   - 修改系统日期或等待次日
   - 确认可以再次使用分享奖励

## 产品价值

### 用户价值

✅ **降低焦虑**：
- 不是"付费才能看完整报告"
- 而是"同一份诊断，换个角度看"

✅ **增加粘性**：
- 每天可以解锁新视角
- 鼓励用户多日回访

✅ **提升体验**：
- 不重复检测，响应速度快
- 多角度分析，更全面

### 商业价值

✅ **控制成本**：
- 一次模型调用，多次价值释放
- 不因分享而增加 API 成本

✅ **提升传播**：
- 分享有明确价值（解锁新视角）
- 不是空洞的"分享赚钱"

✅ **数据沉淀**：
- 记录用户解锁行为
- 分析哪些视角最受欢迎

## 未来优化方向

### 1. 视角推荐

根据用户账号特征，智能推荐最相关的视角优先解锁。

### 2. 视角组合

允许用户选择想要解锁的视角组合，而不是固定顺序。

### 3. 社交裂变

好友通过分享链接注册后，双方都解锁额外视角。

### 4. 付费直接解锁

提供"¥9.9 解锁所有视角"的快捷选项。

### 5. 视角深度

每个视角可以有"简版"和"深度版"，进一步延长解锁路径。

## 注意事项

⚠️ **关键原则**：
1. **绝不因分享重新调用模型**
2. **所有视角来自首次诊断缓存**
3. **每日最多 1 次分享奖励**
4. **所有视角解锁后，隐藏分享入口**

⚠️ **用户体验**：
1. 锁定视角要有明确的"分享后解锁"提示
2. 分享成功后要有即时反馈
3. 今日已分享要有友好提示
4. 所有视角解锁后要有庆祝反馈

⚠️ **技术实现**：
1. 解锁状态存储在 localStorage
2. 每日限制通过日期字符串判断
3. 开发环境提供重置功能
4. 生产环境要防止作弊（如修改 localStorage）

## 总结

多视角诊断功能通过**一次模型调用，多次价值释放**的策略，在控制成本的前提下，提升了用户留存与传播率。这是一个**产品设计驱动增长**的典型案例，而不是简单的技术堆砌。
