# 多视角诊断功能 - 测试指南

## 测试环境

✅ **服务器状态**：
- 前端：http://localhost:3000 (运行中)
- 后端：http://localhost:3001 (运行中)

## 测试流程

### 第一步：完成首次诊断

1. 访问 http://localhost:3000
2. 点击"开启今日问诊"
3. 上传账号主页截图
4. 填写账号信息（可选）
5. 点击"开始诊断"
6. 等待 AI 分析（约 10-15 秒）

**预期结果**：
- ✅ 看到初步诊断结果页面
- ✅ 包含：当前阶段判断、核心卡点结论、判断依据、维度评分
- ✅ 底部有"查看多视角诊断"入口（蓝色卡片）

### 第二步：进入多视角页面

1. 在初步诊断结果页面
2. 找到"想从更多角度看这份诊断？"卡片
3. 点击"查看多视角诊断"按钮

**预期结果**：
- ✅ 进入多视角诊断页面
- ✅ 顶部显示综合评分（X/10）
- ✅ 显示快速结论
- ✅ 看到 6 个视角卡片：
  - ✅ 内容视角（彩色，已解锁）
  - 🔒 用户心理视角（灰色，锁定）
  - 🔒 增长瓶颈视角（灰色，锁定）
  - 🔒 账号定位视角（灰色，锁定）
  - 🔒 优化行动视角（灰色，锁定）
  - 🔒 案例参考视角（灰色，锁定）
- ✅ 底部显示"分享解锁更多视角"按钮

### 第三步：测试分享解锁

1. 在多视角页面底部
2. 点击"分享解锁更多视角"按钮
3. 在弹出的模态框中查看信息
4. 点击"生成分享卡片"按钮

**预期结果**：
- ✅ 弹出分享模态框
- ✅ 显示"分享即可解锁更多视角"标题
- ✅ 显示"分享后解锁 2-3 个新视角"提示
- ✅ 显示"关于视角解锁"说明
- ✅ 点击后弹出成功提示：
  ```
  🎉 已解锁新视角
  
  我们帮你从「用户心理视角、增长瓶颈视角、账号定位视角」角度，
  重新看了这份诊断
  ```
- ✅ 返回多视角页面，看到 3 个新视角已解锁（彩色卡片）

### 第四步：测试每日限制

1. 在多视角页面
2. 再次点击"分享解锁更多视角"按钮
3. 在模态框中点击"生成分享卡片"

**预期结果**：
- ✅ 弹出提示："今天已经使用过分享奖励啦～"
- ✅ 分享按钮显示为"今日已分享"（禁用状态）
- ✅ 模态框中显示黄色提示卡片

### 第五步：测试所有视角解锁

1. 打开浏览器控制台（F12）
2. 执行以下代码重置状态：
```javascript
localStorage.removeItem('unlock_status');
location.reload();
```
3. 重新完成诊断
4. 进入多视角页面
5. 分享解锁 3 次（需要修改日期或等待次日）

**预期结果**：
- ✅ 第 1 次分享：解锁 3 个视角（用户心理、增长瓶颈、账号定位）
- ✅ 第 2 次分享：解锁 2 个视角（优化行动、案例参考）
- ✅ 所有视角解锁后：
  - 底部不再显示"分享解锁"按钮
  - 或显示"🎉 所有视角已解锁"提示

### 第六步：测试完整报告集成

1. 在初步诊断结果页面
2. 点击"解锁查看我的账号调整方案（￥29.9）"
3. 在支付模态框中点击"模拟支付成功"
4. 进入完整报告页面
5. 点击底部"查看多视角诊断"按钮

**预期结果**：
- ✅ 从完整报告页面也能进入多视角页面
- ✅ 点击返回按钮回到完整报告页面（而不是初步诊断）
- ✅ 多视角功能与付费报告独立，互不影响

## 测试检查清单

### 功能测试

- [ ] 首次诊断生成完整数据池（6个视角）
- [ ] 默认只展示 1 个视角（内容视角）
- [ ] 点击"查看多视角诊断"进入多视角页面
- [ ] 锁定视角显示为灰色 + 模糊内容 + 🔒 图标
- [ ] 点击"分享解锁"成功解锁 2-3 个视角
- [ ] 分享成功后显示解锁提示（弹窗）
- [ ] 今日已分享后显示限制提示
- [ ] 所有视角解锁后隐藏分享按钮
- [ ] 返回按钮功能正常（返回到正确的页面）

### UI 测试

- [ ] 多视角页面布局正常（无错位）
- [ ] 视角卡片颜色区分清晰（6种不同颜色）
- [ ] 锁定视角有明确的 🔒 图标和"分享后解锁"文字
- [ ] 分享模态框文案清晰易懂
- [ ] 底部分享按钮位置合理（固定在底部）
- [ ] 综合评分显示正常（X/10 格式）
- [ ] 快速结论文字显示完整

### 边界测试

- [ ] 没有 multiViewDiagnosis 数据时不显示入口
- [ ] 所有视角已解锁时隐藏分享按钮
- [ ] 今日已分享时禁用分享按钮
- [ ] localStorage 数据异常时使用默认值
- [ ] 刷新页面后解锁状态保持
- [ ] 跨页面导航后状态正常

### 文案测试

- [ ] 入口文案："想从更多角度看这份诊断？"
- [ ] 页面标题："多视角诊断"
- [ ] 副标题："同一份诊断，从不同角度看"
- [ ] 提示信息："以下所有视角来自同一次诊断结果..."
- [ ] 锁定提示："🔒 分享后解锁"
- [ ] 分享按钮："分享解锁更多视角"
- [ ] 成功提示："🎉 已解锁新视角"
- [ ] 限制提示："今天已经使用过分享奖励啦～"

## 常见问题排查

### 问题 1：看不到"查看多视角诊断"入口

**可能原因**：
- AI 返回的数据中没有 `multiViewDiagnosis` 字段
- Prompt A 没有正确生成多视角数据

**排查方法**：
1. 打开浏览器控制台
2. 查看诊断结果：
```javascript
// 在 App.tsx 中添加 console.log
console.log('Diagnosis Result:', result);
```
3. 检查是否有 `result.multiViewDiagnosis` 字段

**解决方法**：
- 确保 Prompt A 的输出格式包含 `multiViewDiagnosis`
- 检查 AI 模型是否正确返回数据

### 问题 2：分享后没有解锁新视角

**可能原因**：
- `unlockByShare()` 函数没有正确执行
- localStorage 没有更新

**排查方法**：
1. 打开浏览器控制台
2. 查看 localStorage：
```javascript
console.log(localStorage.getItem('unlock_status'));
```
3. 检查 `unlocked_modules` 数组是否更新

**解决方法**：
- 检查 `unlockManager.ts` 中的逻辑
- 确保 `saveUnlockStatus()` 正确执行

### 问题 3：今日已分享但次日没有重置

**可能原因**：
- 日期判断逻辑错误
- `last_share_date` 没有正确更新

**排查方法**：
1. 查看 localStorage 中的 `last_share_date`
2. 检查当前日期：
```javascript
console.log(new Date().toDateString());
```

**解决方法**：
- 检查 `getUnlockStatus()` 中的日期比较逻辑
- 确保使用 `toDateString()` 格式化日期

### 问题 4：所有视角解锁后仍显示分享按钮

**可能原因**：
- `isAllModulesUnlocked()` 判断错误
- 视角数量计算错误

**排查方法**：
1. 查看已解锁的视角数量：
```javascript
import { getUnlockStatus } from './services/unlockManager';
console.log(getUnlockStatus().unlocked_modules.length);
```
2. 应该是 6（所有视角）

**解决方法**：
- 检查 `isAllModulesUnlocked()` 逻辑
- 确保所有视角 ID 都在 `UNLOCKABLE_MODULES` 中

## 性能测试

### 加载速度

- [ ] 多视角页面加载时间 < 1 秒
- [ ] 分享解锁响应时间 < 500ms
- [ ] 页面切换动画流畅（60fps）

### 内存占用

- [ ] 多视角数据不重复存储
- [ ] localStorage 大小合理（< 10KB）
- [ ] 无内存泄漏

## 数据验证

### localStorage 结构

```javascript
// 初始状态
{
  "unlock_status": {
    "share_reward_used_today": false,
    "unlocked_modules": ["content_view"],
    "last_share_date": ""
  }
}

// 分享后
{
  "unlock_status": {
    "share_reward_used_today": true,
    "unlocked_modules": [
      "content_view",
      "user_psychology_view",
      "growth_bottleneck_view",
      "account_positioning_view"
    ],
    "last_share_date": "Thu Feb 05 2026"
  }
}
```

### 诊断结果结构

```javascript
{
  "clarityPhase": "方向还在探索中",
  "phaseInspiration": "...",
  "empathyMessage": "...",
  "dimensions": [...],
  "multiViewDiagnosis": {
    "base_summary": "...",
    "core_score": 6,
    "diagnosis_modules": {
      "content_view": {
        "id": "content_view",
        "title": "内容视角",
        "content": "..."
      },
      // ... 其他 5 个视角
    }
  }
}
```

## 测试完成标准

### 必须通过

- ✅ 所有功能测试项通过
- ✅ 所有 UI 测试项通过
- ✅ 所有边界测试项通过
- ✅ 无控制台错误
- ✅ 无 TypeScript 类型错误

### 建议通过

- ✅ 所有文案测试项通过
- ✅ 性能测试达标
- ✅ 数据结构验证通过

## 测试报告模板

```markdown
# 多视角诊断功能测试报告

## 测试信息
- 测试日期：2026-02-05
- 测试人员：[姓名]
- 测试环境：Chrome 120 / macOS

## 测试结果
- 功能测试：✅ 通过 / ❌ 未通过
- UI 测试：✅ 通过 / ❌ 未通过
- 边界测试：✅ 通过 / ❌ 未通过
- 文案测试：✅ 通过 / ❌ 未通过

## 发现的问题
1. [问题描述]
   - 严重程度：高 / 中 / 低
   - 复现步骤：...
   - 预期结果：...
   - 实际结果：...

## 改进建议
1. [建议内容]

## 总体评价
[整体评价]
```

## 下一步

测试通过后：
1. ✅ 提交代码
2. 📝 更新产品文档
3. 📊 添加数据埋点
4. 🚀 准备上线

---

**开始测试**：http://localhost:3000
**测试时间**：预计 15-20 分钟
**测试重点**：分享解锁流程 + 每日限制
