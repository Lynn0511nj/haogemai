# 多视角诊断 - 快速开始

## 功能简介

**分享解锁多诊断视角** - 一次诊断，六个视角，不重跑模型

- ✅ 首次诊断生成完整数据池（6个视角）
- ✅ 默认只展示 1 个视角（内容视角）
- ✅ 分享后解锁 2-3 个新视角
- ✅ 每天最多 1 次分享奖励
- ✅ 所有视角来自缓存，不重跑模型

## 用户体验流程

### 1. 完成首次诊断

```
用户上传图片 → AI 分析 → 生成完整数据池
```

**生成的数据**：
- 基础诊断结果（免费展示）
- 6 个诊断视角（部分锁定）

### 2. 查看初步诊断

```
初步诊断结果页
├── 当前阶段判断
├── 核心卡点结论
├── 判断依据
├── 维度评分
└── [查看多视角诊断] 按钮 ← 新增
```

### 3. 进入多视角页面

```
多视角诊断页
├── 综合评分：X/10
├── 快速结论
├── ✅ 内容视角（已解锁）
├── 🔒 用户心理视角（锁定）
├── 🔒 增长瓶颈视角（锁定）
├── 🔒 账号定位视角（锁定）
├── 🔒 优化行动视角（锁定）
├── 🔒 案例参考视角（锁定）
└── [分享解锁更多视角] 按钮
```

### 4. 分享解锁

```
点击分享按钮 → 分享模态框
├── 提示：分享后解锁 2-3 个新视角
├── 说明：基于同一份诊断，不重复检测
└── [生成分享卡片] 按钮

分享成功 → 🎉 已解锁新视角
├── 用户心理视角
├── 增长瓶颈视角
└── 账号定位视角
```

### 5. 每日限制

```
今日已分享 → 提示：今天已经使用过分享奖励啦～
次日重置 → 可再次分享解锁剩余视角
```

## 六大诊断视角

| 视角 | 默认状态 | 分析角度 | 图标 |
|------|---------|---------|------|
| 内容视角 | ✅ 解锁 | 内容质量、情绪唤起能力 | 📄 |
| 用户心理视角 | 🔒 锁定 | 用户看到主页时的心理感受 | 😊 |
| 增长瓶颈视角 | 🔒 锁定 | 增长卡点、流量瓶颈 | 📈 |
| 账号定位视角 | 🔒 锁定 | 账号定位、标签收敛 | 📍 |
| 优化行动视角 | 🔒 锁定 | 可执行的优化行动 | ✅ |
| 案例参考视角 | 🔒 锁定 | 同类型账号案例 | 📚 |

## 技术实现要点

### 1. 数据生成（Prompt A）

在 `services/promptA_quickDiagnosis.ts` 中，AI 一次性生成：

```json
{
  "clarityPhase": "...",
  "phaseInspiration": "...",
  "empathyMessage": "...",
  "dimensions": [...],
  "multiViewDiagnosis": {
    "base_summary": "...",
    "core_score": 6,
    "diagnosis_modules": {
      "content_view": { "id": "content_view", "title": "内容视角", "content": "..." },
      "user_psychology_view": { ... },
      "growth_bottleneck_view": { ... },
      "account_positioning_view": { ... },
      "optimization_actions_view": { ... },
      "case_reference_view": { ... }
    }
  }
}
```

### 2. 解锁管理（unlockManager.ts）

```typescript
// 获取解锁状态
const status = getUnlockStatus();
// { share_reward_used_today: false, unlocked_modules: ['content_view'], last_share_date: '' }

// 检查是否可以分享
const canShare = canUseShareReward(); // true

// 执行分享解锁
const newlyUnlocked = unlockByShare();
// ['user_psychology_view', 'growth_bottleneck_view', 'account_positioning_view']

// 获取剩余视角数量
const remaining = getRemainingModulesCount(); // 2
```

### 3. UI 展示（MultiViewDiagnosis.tsx）

```typescript
<MultiViewDiagnosis 
  result={result}                              // 诊断结果
  onBack={() => setStep(AppStep.RESULT)}       // 返回按钮
  onShareClick={() => setShowShareModal(true)} // 分享按钮
/>
```

## 开发测试

### 测试步骤

1. **启动服务**：
```bash
# 后端
cd server && npm start

# 前端
npm run dev
```

2. **完成诊断**：
   - 访问 http://localhost:3000
   - 上传图片，完成诊断
   - 查看初步诊断结果

3. **查看多视角**：
   - 点击"查看多视角诊断"
   - 确认只有 1 个视角解锁

4. **测试分享**：
   - 点击"分享解锁更多视角"
   - 点击"生成分享卡片"
   - 确认解锁 2-3 个新视角

5. **测试每日限制**：
   - 再次点击分享按钮
   - 确认提示"今天已经使用过分享奖励啦～"

### 重置测试数据

在浏览器控制台执行：

```javascript
// 重置解锁状态
localStorage.removeItem('unlock_status');

// 重置诊断限制
localStorage.removeItem('lastDiagnosisTime');

// 刷新页面
location.reload();
```

## UI 文案速查

### 入口文案

**初步诊断结果页**：
```
想从更多角度看这份诊断？
同一份诊断，我们还准备了 6 个不同视角：
内容、定位、用户心理、增长瓶颈、优化行动、案例参考
```

### 多视角页面

**页面标题**：
```
多视角诊断
同一份诊断，从不同角度看
```

**提示信息**：
```
以下所有视角来自同一次诊断结果，不会重复检测，
但会带你看到之前没展示的分析角度。
```

**锁定视角**：
```
🔒 分享后解锁
```

**底部提示**：
```
还有 X 个视角未解锁
分享后立即解锁 2-3 个新视角
```

### 分享模态框

**标题**：
```
分享即可解锁更多视角
```

**描述**：
```
同一份诊断，从不同角度看，会有新的发现。
分享后解锁 2-3 个新视角
```

**说明**：
```
关于视角解锁
本次解锁基于同一份诊断结果，不会重复检测，
但会带你看到之前没展示的分析角度。
```

**成功反馈**：
```
🎉 已解锁新视角
我们帮你从「用户心理视角、增长瓶颈视角」角度，
重新看了这份诊断
```

**限制提示**：
```
今天已经使用过分享奖励啦～
```

## 关键原则

### ✅ 必须遵守

1. **不重跑模型**：所有视角来自首次诊断缓存
2. **每日限制**：每天最多 1 次分享奖励
3. **明确提示**：锁定视角要有清晰的解锁说明
4. **即时反馈**：分享成功后立即显示解锁结果

### ❌ 禁止操作

1. 因分享而重新调用 AI 模型
2. 绕过每日限制（除非开发测试）
3. 隐藏"基于同一份诊断"的说明
4. 让用户误以为会重新检测

## 产品价值

### 用户价值

- 🎯 **降低焦虑**：不是"付费才能看"，而是"换个角度看"
- 🔄 **增加粘性**：每天可以解锁新视角，鼓励多日回访
- ⚡ **提升体验**：不重复检测，响应速度快

### 商业价值

- 💰 **控制成本**：一次模型调用，多次价值释放
- 📈 **提升传播**：分享有明确价值（解锁新视角）
- 📊 **数据沉淀**：记录用户解锁行为，分析视角偏好

## 常见问题

### Q1: 为什么不直接展示所有视角？

**A**: 产品策略考虑：
- 控制信息过载，避免用户一次看太多内容
- 通过分享解锁，提升传播率
- 延长用户生命周期，鼓励多日回访

### Q2: 分享后会重新检测吗？

**A**: 不会。所有视角来自首次诊断时生成的数据池，分享只是解锁查看权限，不会重新调用 AI 模型。

### Q3: 每天只能分享一次吗？

**A**: 是的。每天最多 1 次分享奖励，次日自动重置。这样可以：
- 控制解锁速度，延长用户生命周期
- 避免用户一次性解锁所有视角
- 鼓励用户多日回访

### Q4: 付费用户也需要分享解锁吗？

**A**: 是的。付费解锁的是"7天行动清单"，多视角诊断是独立的功能，需要通过分享解锁。

### Q5: 如何防止用户作弊（如修改 localStorage）？

**A**: 当前版本使用 localStorage 存储，主要用于 MVP 验证。生产环境建议：
- 将解锁状态存储在服务端
- 通过用户 ID 关联解锁记录
- 添加分享验证机制（如分享链接点击量）

## 下一步

1. ✅ 功能已实现，可以开始测试
2. 📝 根据测试反馈优化 UI 文案
3. 📊 收集用户数据，分析哪些视角最受欢迎
4. 🚀 考虑增加"付费直接解锁所有视角"选项

---

**核心理念**：一次诊断，多次价值释放，不重跑模型 🎯
